<!DOCTYPE html>
<html>
    <head>
        <meta charset='gutf-8'>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
        <script src="http://malsup.github.com/jquery.form.js"></script>
        <title>{{ title }}</title>
    </head>
    <body>
    <button type='button' class='start_button' href='/start'>Start</button>
    <button type='button' class='stop_button' href='/stop'>Stop</button>
    <pre class='crawl_status'>Crawl Status: </pre>
	<form class='search' method='POST' action='/search' onsubmit="return submitForm()">
        {{ form.csrf_token }}
        <ul>
            <li> {{ form.regionid.label }} {{ form.regionid }} </li><br/>
            <li> {{ form.price_upper.label }} {{ form.price_upper }}
                 {{ form.price_lower.label }} {{ form.price_lower }} </li><br/>
            <li> {{ form.area_upper.label }} {{ form.area_upper }}
                 {{ form.area_lower.label }} {{ form.area_lower }} </li><br/>
            <li> {{ form.lessor_sex.label }} {{ form.lessor_sex }} </li><br/>
            <li> {{ form.role_type.label }} {{ form.role_type }} </li><br/>
            <li> {{ form.linkman.label }} {{ form.linkman }}</li><br/>
            <li> {{ form.tel.label }} {{ form.tel }}</li><br/>
            <li> {{ form.sex.label }} {{ form.sex }} </li><br/>
        </ul>
        {{ form.submit }}
	</form>

    <pre>Show only frist 100 data.</pre>
    <pre class='search_response'></pre>
    <pre class='json_data'></pre>

    <script>
       $('.start_button').on('click', function(){
           $('.crawl_status').text('Status: request sent.');
           $.post('/start', {},
               function(response) {
                   console.log(response.message);
                   $('.crawl_status').text('Status: ' + response.message);
               }).fail(function() {
                   console.log('start error');
                   $('.crawl_status').text('Status: crawler encounter error.');
               });
       });
       $('.stop_button').on('click', function(){
           $('.crawl_status').text('Status: stopping.');
           $.post('/stop', {},
               function(response) {
                   console.log(response.message);
                   $('.crawl_status').text('Status: ' + response.message);
               }).fail(function() {
                   console.log('stop error');
                   $('.crawl_status').text('Status: crawler encounter error when stopping.');
               });
       });
       function submitForm() {
           $(".search").ajaxSubmit({
               success: function(response) {
                   $(".json_data").text(response.data);
                   $(".search_response").text(response.message);
                   console.log(response.message);
               },
               error: function (response) {
                   $(".search_response").text('search encounter error.');
                   console.log('search encounter error.')
               }
           });
           return false;
       }
    </script>
    </body>
</html>
